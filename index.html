<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¥µç°¡ä»»å‹™å„€è¡¨æ¿</title>
    <style>
        :root {
            --bg: #f0f2f5;
            --card: #ffffff;
            --daily: #3498db;
            --weekly: #9b59b6;
            --once: #e67e22;
            --text: #2c3e50;
            --done: #ebf5eb;
        }
        * { box-sizing: border-box; }
        body { font-family: -apple-system, "Noto Sans TC", sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; font-size: 14px; }
        
        .dashboard { max-width: 1100px; margin: auto; }
        header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; padding: 0 5px; }
        h1 { margin: 0; font-size: 1.2rem; display: flex; align-items: center; gap: 8px; }
        .info-bar { text-align: right; font-size: 12px; color: #7f8c8d; }

        /* ä¸‰æ¬„ä½ˆå±€ */
        .grid-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        
        .section { background: var(--card); border-radius: 8px; padding: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .section-header { border-bottom: 2px solid #eee; margin-bottom: 8px; padding-bottom: 5px; }
        .title { font-weight: bold; font-size: 15px; display: flex; justify-content: space-between; }
        .subtitle { font-size: 11px; color: #95a5a6; margin-top: 2px; }

        /* é€²åº¦æ¢è¿·ä½ åŒ– */
        .prog-bg { background: #eee; height: 4px; border-radius: 2px; margin: 5px 0 10px 0; }
        .prog-fill { height: 100%; border-radius: 2px; transition: 0.3s; width: 0%; }

        /* ä»»å‹™æ¸…å–®ç·Šæ¹ŠåŒ– */
        .task-list { flex-grow: 1; }
        .task-item { display: flex; align-items: center; padding: 6px 8px; margin-bottom: 4px; border-radius: 4px; cursor: pointer; border: 1px solid transparent; background: #fdfdfd; }
        .task-item:hover { background: #f5f5f5; }
        .task-item.completed { background: var(--done); color: #95a5a6; }
        .task-item.completed span { text-decoration: line-through; }
        input[type="checkbox"] { margin-right: 8px; pointer-events: none; }
        .task-text { font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* æ­·å²ç´€éŒ„ */
        .history-section { margin-top: 15px; background: #fff; border-radius: 8px; padding: 10px; }
        details summary { cursor: pointer; font-weight: bold; color: #7f8c8d; }
        .history-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 8px; margin-top: 10px; }
        .history-card { font-size: 11px; padding: 5px; border-left: 3px solid #ccc; background: #f9f9f9; }

        @media (max-width: 850px) {
            .grid-container { grid-template-columns: 1fr; }
            body { padding: 5px; }
        }
    </style>
</head>
<body>

<div class="dashboard">
    <header>
        <h1>ğŸ® ä»»å‹™åŠ©æ‰‹ <span id="event-timer" style="color: #e74c3c; font-size: 12px;"></span></h1>
        <div class="info-bar">
            <div id="wall-clock"></div>
            <div style="color: #e67e22; font-weight: bold;">08:00 AM è‡ªå‹•çµç®—é‡ç½®</div>
        </div>
    </header>

    <div class="grid-container">
        <div class="section" style="border-top: 4px solid var(--daily);">
            <div class="section-header">
                <div class="title" style="color: var(--daily);">æ¯æ—¥ä»»å‹™ <span id="daily-count">0/0</span></div>
                <div class="subtitle" id="daily-date">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="prog-bg"><div id="daily-bar" class="prog-fill" style="background: var(--daily);"></div></div>
            <div id="daily-list" class="task-list"></div>
        </div>

        <div class="section" style="border-top: 4px solid var(--weekly);">
            <div class="section-header">
                <div class="title" style="color: var(--weekly);">æ¯é€±ä»»å‹™ <span id="weekly-count">0/0</span></div>
                <div class="subtitle" id="weekly-range">è¼‰å…¥ä¸­...</div>
            </div>
            <div class="prog-bg"><div id="weekly-bar" class="prog-fill" style="background: var(--weekly);"></div></div>
            <div id="weekly-list" class="task-list"></div>
        </div>

        <div class="section" style="border-top: 4px solid var(--once);">
            <div class="section-header">
                <div class="title" style="color: var(--once);">ä¸€æ¬¡æ€§ä»»å‹™ <span id="once-count">0/0</span></div>
                <div class="subtitle">æ´»å‹•æœŸé–“å…§å®Œæˆå³å¯</div>
            </div>
            <div class="prog-bg"><div id="once-bar" class="prog-fill" style="background: var(--once);"></div></div>
            <div id="once-list" class="task-list"></div>
        </div>
    </div>

    <div class="history-section">
        <details>
            <summary>æŸ¥çœ‹æ­·å²çµç®— (è‡ªå‹•ä¿å­˜æœ€è¿‘ 10 å¤©)</summary>
            <div id="history-content" class="history-grid"></div>
        </details>
    </div>
</div>

<script>
    const CONFIG = {
        endDate: new Date('2026-03-26T08:00:00'),
        resetHour: 8,
        tasks: {
            daily: ["HAPPYDAYç°½åˆ°", "æ˜¥ç¯€æ°£æ¯*15", "èˆç…æ‰“é¼“", "æ”¶é›†ç¦è¢‹", "ä»Šæ—¥é‹å‹¢"],
            weekly: ["æœ¨é¦¬å£«å…µ/ç´…å¯¶ç ", "åœ˜åœ“é£¯(10/10/10)", "æ˜¥ç¯€çµ„éšŠ(2é€±1)*", "èº²é¿äººé¦¬", "ä¸€é¦¬ç•¶å…ˆ", "å¤©é¦¬äº‚å°„"],
            once: ["é•·è€æ–¯å¦", "é£¯è¼ªéµç”·", "é˜¿å‹’ç±³", "30åƒåœ¾å †"]
        }
    };

    let userData = JSON.parse(localStorage.getItem('gameTracker_v3')) || {
        daily: {}, weekly: {}, once: {}, history: [], lastGameDate: "", lastGameWeek: ""
    };

    // æ ¸å¿ƒæ—¥æœŸé‚è¼¯
    function getGameTime() {
        return new Date(new Date().getTime() - (CONFIG.resetHour * 60 * 60 * 1000));
    }

    function getGameDateStr(dateObj) {
        const days = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
        return `${dateObj.toISOString().split('T')[0]} (é€±${days[dateObj.getDay()]})`;
    }

    function getWeeklyRange() {
        const gameTime = getGameTime();
        const day = gameTime.getDay();
        const diffToThu = (day < 4 ? -7 : 0) + 4 - day;
        const start = new Date(gameTime.getTime() + diffToThu * 86400000);
        const end = new Date(start.getTime() + 6 * 86400000);
        return `${start.getMonth()+1}/${start.getDate()} ~ ${end.getMonth()+1}/${end.getDate()} (é€±å››é‡ç½®)`;
    }

    function init() {
        const nowGameTime = getGameTime();
        const currentGameDate = nowGameTime.toISOString().split('T')[0];
        const currentGameWeek = getWeeklyRange();

        // ã€è‡ªå‹•çµç®—é‚è¼¯ã€‘æ—¥æœŸè®Šäº†ï¼Œå°±è‡ªå‹•æŠŠèˆŠè³‡æ–™å­˜å…¥ history
        if (userData.lastGameDate && userData.lastGameDate !== currentGameDate) {
            autoArchive(userData.lastGameDate);
            userData.daily = {}; // é‡ç½®æ¯æ—¥
        }
        
        // æ¯é€±é‡ç½®
        if (userData.lastGameWeek && userData.lastGameWeek !== currentGameWeek) {
            userData.weekly = {};
            userData.lastGameWeek = currentGameWeek;
        }

        userData.lastGameDate = currentGameDate;
        userData.lastGameWeek = currentGameWeek;

        render();
        updateClocks();
        save();
    }

    function autoArchive(dateStr) {
        const done = CONFIG.tasks.daily.filter((_, i) => userData.daily[i]).length;
        const record = `ğŸ“… ${dateStr} â®• å®Œæˆ ${done}/${CONFIG.tasks.daily.length}`;
        userData.history.unshift(record);
        if (userData.history.length > 10) userData.history.pop();
    }

    function render() {
        const types = ['daily', 'weekly', 'once'];
        types.forEach(type => {
            const items = CONFIG.tasks[type];
            const container = document.getElementById(`${type}-list`);
            const completedCount = items.filter((_, i) => userData[type][i]).length;
            
            // æ›´æ–°è¨ˆæ•¸èˆ‡é€²åº¦æ¢
            document.getElementById(`${type}-count`).innerText = `${completedCount}/${items.length}`;
            document.getElementById(`${type}-bar`).style.width = `${(completedCount / items.length) * 100}%`;

            container.innerHTML = items.map((task, i) => `
                <div class="task-item ${userData[type][i] ? 'completed' : ''}" onclick="toggleTask('${type}', ${i})">
                    <input type="checkbox" ${userData[type][i] ? 'checked' : ''}>
                    <div class="task-text" title="${task}">${task}</div>
                </div>
            `).join('');
        });

        document.getElementById('daily-date').innerText = getGameDateStr(getGameTime());
        document.getElementById('weekly-range').innerText = getWeeklyRange();
        document.getElementById('history-content').innerHTML = userData.history.map(h => `<div class="history-card">${h}</div>`).join('') || "å°šç„¡ç´€éŒ„";
    }

    function toggleTask(type, index) {
        userData[type][index] = !userData[type][index];
        save();
        render();
    }

    function save() {
        localStorage.setItem('gameTracker_v3', JSON.stringify(userData));
    }

    function updateClocks() {
        const now = new Date();
        document.getElementById('wall-clock').innerText = `ç³»çµ±æ™‚é–“: ${now.toLocaleTimeString()}`;
        
        const diff = CONFIG.endDate - now;
        const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
        document.getElementById('event-timer').innerText = days > 0 ? `(å‰© ${days} å¤©çµæŸ)` : "(æ´»å‹•çµæŸ)";
    }

    init();
    setInterval(updateClocks, 1000);
    // æ¯ 10 åˆ†é˜æª¢æŸ¥ä¸€æ¬¡æ˜¯å¦è·¨æ—¥éœ€è¦è‡ªå‹•é‡ç½®
    setInterval(init, 600000);
</script>
</body>
</html>
