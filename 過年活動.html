<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»å‹•ä»»å‹™è¿½è¹¤åŠ©æ‰‹ (8AM é‡ç½®ç‰ˆ)</title>
    <style>
        :root {
            --primary: #4a90e2;
            --daily: #e3f2fd;
            --weekly: #f3e5f5;
            --once: #fff3e0;
            --done: #c8e6c9;
        }
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f4f7f6; color: #333; padding: 20px; line-height: 1.6; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 5px; font-size: 1.5rem; }
        .date-info { text-align: center; font-size: 0.9em; color: #666; margin-bottom: 5px; }
        .reset-note { text-align: center; font-size: 0.8em; color: #e67e22; margin-bottom: 20px; font-weight: bold; }
        .section { margin-bottom: 25px; border-left: 5px solid var(--primary); padding-left: 15px; }
        .section-title { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .task-item { display: flex; align-items: center; background: #fafafa; margin-bottom: 8px; padding: 12px; border-radius: 6px; cursor: pointer; transition: 0.2s; border: 1px solid #eee; }
        .task-item:hover { background: #f0f0f0; }
        .task-item.completed { background: var(--done); border-color: #a5d6a7; color: #666; }
        .task-item.completed span { text-decoration: line-through; }
        input[type="checkbox"] { margin-right: 15px; transform: scale(1.3); pointer-events: none; }
        .footer-btns { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; font-size: 1rem; }
        .btn-save { background: var(--primary); color: white; }
        .btn-history { background: #95a5a6; color: white; }
        #history-panel { margin-top: 20px; display: none; border-top: 2px dashed #ddd; padding-top: 15px; }
        .history-item { font-size: 0.85em; color: #555; border-bottom: 1px solid #eee; padding: 8px 0; display: flex; justify-content: space-between; }
        .bi-weekly-note { font-size: 0.75em; color: #d35400; display: block; margin-top: 2px; }
        .tag { font-size: 0.7em; padding: 2px 6px; border-radius: 4px; color: white; margin-left: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ® æ´»å‹•ä»»å‹™è¿½è¹¤</h1>
    <div class="date-info" id="current-date-display"></div>
    <div class="reset-note">æ¯æ—¥ 08:00 AM é‡ç½®</div>
    <div class="date-info" id="event-countdown" style="color: #e74c3c; font-weight: bold;"></div>

    <div class="section" style="border-color: #2196F3;">
        <div class="section-title">æ¯æ—¥ä»»å‹™ <span class="tag" style="background:#2196F3;">DAILY</span></div>
        <div id="daily-list"></div>
    </div>

    <div class="section" style="border-color: #9c27b0;">
        <div class="section-title">æ¯é€±ä»»å‹™ <span class="tag" style="background:#9c27b0;">WEEKLY</span></div>
        <div id="weekly-list"></div>
    </div>

    <div class="section" style="border-color: #ff9800;">
        <div class="section-title">ä¸€æ¬¡æ€§ä»»å‹™ <span class="tag" style="background:#ff9800;">ONCE</span></div>
        <div id="once-list"></div>
    </div>

    <div class="footer-btns">
        <button class="btn-save" onclick="archiveToday()">æ‰‹å‹•çµç®—å­˜æª”</button>
        <button class="btn-history" onclick="toggleHistory()">æª¢è¦–æ­·å²ç´€éŒ„</button>
    </div>

    <div id="history-panel">
        <h3>æœ€è¿‘ 7 ç­†çµç®—ç´€éŒ„</h3>
        <div id="history-content"></div>
    </div>
</div>

<script>
    // --- é…ç½®å€ ---
    const CONFIG = {
        endDate: new Date('2026-03-26T08:00:00'), // æ´»å‹•æˆªæ­¢æ—¥
        resetHour: 8, // æ—©ä¸Š 8 é»é‡ç½®
        tasks: {
            daily: [
                "HAPPYDAYæ¯æ—¥ç°½åˆ°*300éš»", "æ˜¥ç¯€æ°£æ¯*15æ¬¡", "GMéœ²éœ²-ä½¿ç”¨é­ç‚®é€²å…¥æ‰“èˆç…", "GMéœ²éœ²-æ”¶é›†ç¦è¢‹", "å°è–‡å®‰-ä»Šæ—¥é‹å‹¢æŠ½ç±¤"
            ],
            weekly: [
                "åŠ åŠ æœ¨é¦¬å£«å…µå¡ç‰‡ / ç´…è‰²å¯¶ç ", "GMéœ²éœ²-åœ˜åœ“é£¯ (ä¸‰ç¨®å„10)", "GMéœ²éœ²-æ˜¥ç¯€çµ„éšŠ (2é€±1æ†‘è­‰) *", "GMéœ²éœ²-èº²é¿äººé¦¬", "å°è–‡å®‰-ä¸€é¦¬ç•¶å…ˆ", "æ±Ÿ-å¤©é¦¬äº‚å°„"
            ],
            once: [
                "é•·è€æ–¯å¦ (å¼“ç®­æ‰‹æ‘)", "é£¯è¼ªéµç”· (å¼“ç®­æ‰‹æ‘)", "é˜¿å‹’ç±³ (é‚±æ¯”ç‰¹å…¬åœ’)", "GMéœ²éœ²-30åƒåœ¾å †"
            ]
        }
    };

    // --- æ ¸å¿ƒé‚è¼¯ ---
    let userData = JSON.parse(localStorage.getItem('gameTrackerData_v2')) || {
        daily: {}, weekly: {}, once: {}, history: [], lastGameDate: ""
    };

    // å–å¾—ã€ŒéŠæˆ²æ—¥ã€å­—ä¸² (ç¾åœ¨æ™‚é–“æ¸›å»8å°æ™‚å¾Œçš„æ—¥æœŸ)
    function getGameDateStr() {
        const now = new Date();
        const gameTime = new Date(now.getTime() - (CONFIG.resetHour * 60 * 60 * 1000));
        return gameTime.toISOString().split('T')[0];
    }

    // å–å¾—ã€ŒéŠæˆ²é€±ã€å­—ä¸² (ç”¨æ–¼æ¯é€±å››é‡ç½®åˆ¤å®š)
    function getGameWeekStr() {
        const now = new Date();
        const gameTime = new Date(now.getTime() - (CONFIG.resetHour * 60 * 60 * 1000));
        // è¨ˆç®—è©²æ—¥æœŸæ‰€åœ¨çš„é€±å›› (éŠæˆ²é‡ç½®æ—¥)
        const day = gameTime.getDay();
        const diff = (day < 4 ? -7 : 0) + 4 - day; 
        const lastThursday = new Date(gameTime.getTime() + diff * 86400000);
        return lastThursday.toISOString().split('T')[0];
    }

    function init() {
        const currentGameDate = getGameDateStr();
        const currentGameWeek = getGameWeekStr();

        // æ¯æ—¥é‡ç½®åˆ¤å®š
        if (userData.lastGameDate !== currentGameDate) {
            userData.daily = {}; // æ¸…ç©ºæ¯æ—¥
            userData.lastGameDate = currentGameDate;
        }

        // æ¯é€±é‡ç½®åˆ¤å®š (å¦‚æœä¸Šæ¬¡è¨˜éŒ„çš„é€±å››è·Ÿé€™é€±çš„é€±å››ä¸åŒï¼Œå°±é‡ç½®)
        if (userData.lastGameWeek !== currentGameWeek) {
            userData.weekly = {};
            userData.lastGameWeek = currentGameWeek;
        }

        renderTasks();
        updateUI();
        save();
    }

    function renderTasks() {
        const render = (items, type, containerId) => {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map((task, i) => `
                <div class="task-item ${userData[type][i] ? 'completed' : ''}" onclick="toggleTask('${type}', ${i})">
                    <input type="checkbox" ${userData[type][i] ? 'checked' : ''}>
                    <span>
                        ${task}
                        ${(type === 'weekly' && task.includes('*')) ? '<span class="bi-weekly-note">âš ï¸ æ­¤ä»»å‹™æ¯å…©é€±æœ€å¤šæ›1æ†‘è­‰</span>' : ''}
                    </span>
                </div>
            `).join('');
        };

        render(CONFIG.tasks.daily, 'daily', 'daily-list');
        render(CONFIG.tasks.weekly, 'weekly', 'weekly-list');
        render(CONFIG.tasks.once, 'once', 'once-list');
    }

    function toggleTask(type, index) {
        userData[type][index] = !userData[type][index];
        save();
        renderTasks();
    }

    function save() {
        localStorage.setItem('gameTrackerData_v2', JSON.stringify(userData));
    }

    function updateUI() {
        const now = new Date();
        document.getElementById('current-date-display').innerText = `ç¾åœ¨æ™‚é–“ï¼š${now.toLocaleString('zh-TW')}`;
        
        const diff = CONFIG.endDate - now;
        const days = Math.ceil(diff / (1000 * 60 * 60 * 24));
        document.getElementById('event-countdown').innerText = days > 0 ? `è·é›¢ 3/26 ç¶­è­·é‚„æœ‰ï¼š${days} å¤©` : "æ´»å‹•å·²çµæŸ";
    }

    function archiveToday() {
        const todayStr = getGameDateStr();
        const dailyCount = CONFIG.tasks.daily.filter((_, i) => userData.daily[i]).length;
        const record = `ã€${todayStr}ã€‘ å®Œæˆåº¦: ${dailyCount}/${CONFIG.tasks.daily.length}`;
        
        userData.history.unshift(record);
        if (userData.history.length > 7) userData.history.pop();
        
        save();
        alert("å­˜æª”æˆåŠŸï¼ç´€éŒ„æœƒä¿å­˜åœ¨ã€Œæª¢è¦–æ­·å²ç´€éŒ„ã€ä¸­ã€‚");
        renderHistory();
    }

    function toggleHistory() {
        const panel = document.getElementById('history-panel');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        renderHistory();
    }

    function renderHistory() {
        const container = document.getElementById('history-content');
        container.innerHTML = userData.history.map(h => `<div class="history-item">${h}</div>`).join('') || "å°šç„¡çµç®—ç´€éŒ„";
    }

    init();
    // æ¯ä¸€åˆ†é˜æ›´æ–°ä¸€æ¬¡æ™‚é–“ UI
    setInterval(updateUI, 60000);
</script>

<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>
</html>